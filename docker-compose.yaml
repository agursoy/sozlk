version: '3'
services:
  strapi:
    build: ./backend
    ports:
      - "1337:1337"
    env_file:
      - ./backend/.env
  nuxt:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - "strapi"
    restart: always
    env_file:
      - ./frontend/.env
    links:
      - "strapi"
    volumes:
      - certbot-webroot-sozlk.com:/usr/src/app/.well-known
      - certbot-letsencrypt:/etc/letsencrypt
    networks:
      - strapi_default
  certbot:
    build: ./certbot
    container_name: certbot
    depends_on:
      - "nuxt"
    restart: always
    volumes:
      - certbot-webroot-sozlk.com:/webroots/sozlk.com/.well-known
      - certbot-letsencrypt:/etc/letsencrypt
  nginx:
    build: ./nginx
    container_name: nginx
    depends_on:
      - "certbot"
    ports:
      - "80:80"
      - "443:443"
    restart: always
    volumes:
      - certbot-webroot-sozlk.com:/webroots/sozlk.com/.well-known
      - certbot-letsencrypt:/etc/letsencrypt
volumes:
  certbot-webroot-sozlk.com:
  certbot-letsencrypt:

networks:
  strapi_default:
    external: true